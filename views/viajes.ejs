<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>dashboard</title>


    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link
        href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
        rel="stylesheet">

  
    <link href="/css/dashboard.css" rel="stylesheet">
    <link href="/css/dashboard1.css" rel="stylesheet">
    <link href="/css/viajes.css" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">



</head>

<body id="page-top">


   
    <div id="wrapper" class="fondo">



        
        <ul class="navbar-nav sidebar sidebar-dark accordion" id="accordionSidebar" style="background-color:  #ff3131;">


          
            <a class="sidebar-brand d-flex align-items-center justify-content-center" href="/dashboard">
                <div class="sidebar-brand-icon rotate-n-15">
                    <i class="fas fa-laugh-wink"></i>
                </div>
                <div class="divtrack">
                    <img src="/images/track.png" alt="track_cost" class="logotrack">
                </div>
            </a>

         


         
            <li class="nav-item active dash">
                <a class="nav-link" href="/dashboard">
                    <i class="fas fa-fw fa-tachometer-alt"></i>
                    <span>Dashboard</span></a>
            </li>

            <hr class="sidebar-divider">

          
            <div class="sidebar-heading ">
                sucursales, colaboradores
            </div>

           
            <li class="nav-item">
                <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapse"
                    aria-expanded="true" aria-controls="collapse">
                    <i class="fas fa-fw fa-cog"></i>
                    <span>Gestiones</span>
                    <i class="fas fa-chevron-down">></i>

                </a>
                <div id="collapse" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionSidebar">
                    <div class="bg-white py-2 collapse-inner rounded">
                        <h6 class="collapse-header">opciones:</h6>
                        <a class="collapse-item" href="/colaboradores">administrar colaboradores</a>
                        <a class="collapse-item" href="/sucursales">administrar sucursales</a>
                    </div>
                </div>
            </li>

          
            <hr class="sidebar-divider d-none d-md-block">

            <div class="sidebar-heading">
                viajes, reportes
            </div>

           
            <li class="nav-item">
                <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseTwo"
                    aria-expanded="true" aria-controls="collapseTwo">
                    <span>Gestiones</span>
                    <i class="fas fa-chevron-down">></i>

                </a>
                <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionSidebar">
                    <div class="bg-white py-2 collapse-inner rounded">
                        <h6 class="collapse-header">opciones:</h6>
                        <a class="collapse-item" href="/viajes">registrar viajes</a>
                        <a class="collapse-item" href="/reportes">reportes</a>
                    </div>
                </div>
            </li>

            <!-- Divider -->
            <hr class="sidebar-divider d-none d-md-block">

        </ul>
        <img src="/images/logoBus.png" alt="fondo" class="fondoimg">


        <div class="container mt-5">
            <div class="card shadow-lg">
                <div class="card-header text-white text-center">
                    <h4 class="mb-0">Registro de Viaje</h4>
                </div>
                <div class="card-body">
                    <form id="viajeForm" action="" method="POST">

                    
                        <div class="mb-3">
                            <label class="form-label">Viaje Registrado por:</label>
                            <input type="text" class="form-control" name="usuario_vj" value="<%= usuario.us_nombre %>"
                                readonly>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Sucursal</label>
                            <select class="form-select" id="sucursalSelect" name="sucursal_vj" required>
                                <%sucursales.forEach(suc=> { %>
                                    <option value="<%= suc.sc_id %>">
                                        <%= suc.sc_nombre %>
                                    </option>
                                    <% }); %>
                            </select>
                        </div>

                     
                        <div class="mb-3">
                            <label class="form-label">Colaborador</label>
                            <select class="form-select" id="colaboradorSelect" name="colaborador_vj"></select>
                        </div>

                      
                        <div class="mb-3">
                            <label class="form-label">Distancia (km)</label>
                            <input type="text" class="form-control" id="distanciaColab" name="distancia_vj" readonly>
                        </div>

                      
                        <div class="mb-3">
                            <label class="form-label">Transportista</label>
                            <select class="form-select" id="transportista" name="transportista_vj" required>
                                <% transportista.forEach(tr=> { %>
                                    <option value="<%= tr.tr_id %>" data-tarifa="<%= tr.tr_tarifa %>">
                                        <%= tr.tr_nombre %>
                                    </option>
                                    <% }); %>
                            </select>
                        </div>

                        <div class=" mb-3">
                            <label class="form-label">Tarifa del transportista por km</label>
                            <input type="text" class="form-control tarifa-transportista-input" id="tarifa"
                                name="tarifa_vj" readonly>
                        </div>


                       
                        <div class="mb-3">
                            <label class="form-label">Costo total del viaje</label>
                            <input type="text" class="form-control" id="costoViaje" name="costo_vj" readonly>
                        </div>

                      
                        <div class="d-flex justify-content-between mt-4">
                            <button type="submit" class="btn btn-danger px-4">
                                <i class="bi bi-save"></i> Guardar
                            </button>
                            <button type="button" class="btn btn-primary px-4" onclick="calcularCostoViaje()">
                                <i class="bi bi-x-circle"></i> calcular
                            </button>
                             <button type="reset" class="btn btn-secondary px-4">
                                <i class="bi bi-x-circle"></i> limpiar
                            </button>
                        </div>
                    </form>
                </div>
            </div>

        </div>

        <script>

            let dni = null;

            document.getElementById('sucursalSelect').addEventListener('change', async function () {
                const sucursalId = this.value;
                const response = await fetch(`/viajes/${sucursalId}`);
                const colaboradores = await response.json();

                const selectColab = document.getElementById('colaboradorSelect');
                selectColab.innerHTML = '<option value="">Seleccione un colaborador</option>';

                colaboradores.forEach(c => {
                    const option = document.createElement('option');
                    option.value = c.cl_cedula;
                    option.textContent = c.cl_nombre;
                    selectColab.appendChild(option);
                });


            });


            document.getElementById('colaboradorSelect').addEventListener('change', async function () {
                const cedula = '0502200203769'; //dato estatico para prueba debido a que no toma el this.value;
                const sucursalId = document.getElementById('sucursalSelect').value;

                if (cedula && sucursalId) {
                    const response = await fetch(`/viajes/distancia/${cedula}/${sucursalId}`);
                    const data = await response.json();
                    document.getElementById('distanciaColab').value = data.distancia || '0';
                   // calcularCostoViaje();
                } else {
                    document.getElementById('distanciaColab').value = '';
                    document.getElementById('costoViaje').value = '';
                }
            });


            function calcularCostoViaje(params) {
                const distancia = parseFloat(document.getElementById('distanciaColab').value) || 0;
                const tarifaSelect = parseInt(document.getElementById('tarifa').value) || 0;
                const costoViaje = distancia * tarifaSelect;
                document.getElementById('costoViaje').value = costoViaje.toFixed(2);
            }



        </script>




        <script src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.js"></script>
        <script src="/js/viajes.js"></script>

    </div>

    <!-- CSS de Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

    <!-- jQuery primero -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>

    <!-- Popper.js despuÃ©s -->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>

    <!-- JS de Bootstrap -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>

</html>